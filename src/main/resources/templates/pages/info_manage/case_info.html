<!-- 内容主体区域 -->
<div style="padding: 15px;">

	<div style="width: 100%;margin: 0 auto;margin-bottom: 20px;background: rgb(0,150,136);padding-top: 6px;padding-bottom: 7px;padding-left: 5px;"><span
					style="color: white;font-size: 14px;letter-spacing: 3px;font-weight: bold;"><span style="font-size: 20px">1</span>&nbsp;筛选标签</span></div>

	<form class="layui-form">
		<div class="wrap">
			<div class="label-selected">

				<a href="javascript:;" class="layui-btn layui-btn-sm hide-labelitem" style="float: right; margin: 4px; display: block;line-height: 30px;">收起标签库
				</a>
				<a href="javascript:;" class="layui-btn layui-btn-sm show-labelitem" style="float: right; margin: 4px; display: none;line-height: 30px;">展开标签库
				</a>
				<input type="hidden" name="label">
			</div>
			<div class="layui-col-md12" id="labelItem" style="float: none;">
				<div class="label-item" style="margin-bottom: 20px;">
					<li data="name"><span>住院人姓名</span></li>
					<li data="salaryNumber"><span>工资号</span></li>
					<li data="sex"><span>性别</span></li>
					<li data="illtime"><span>住院时间</span></li>
					<li data="reason"><span>住院原因</span></li>
					<li data="retireDate"><span>探望次数</span></li>



				</div>
			</div>
			<!--<a href="javascript:;" class="layui-btn" id="cell">获取</a>-->
		</div>
	</form>


	<br>
	<br>

	<div style="width: 100%;margin: 0 auto;margin-bottom: 20px;background: rgb(0,150,136);padding-top: 6px;padding-bottom: 7px;padding-left: 5px;"><span
					style="color: white;font-size: 14px;letter-spacing: 3px;font-weight: bold;"><span style="font-size: 20px">2</span>&nbsp;填写信息</span></div>

	<form id="form_search" style="display: none" class="layui-form between-content" method="post" action="/baseInfo/searchByMultipleRegex">
		<style>
			#form_search > .layui-form-item {
				display: none;
			}
		</style>

		<div class="chosen" style="margin-left: 20%;width: 800px;border:1px solid lightgray;" >


			<div class="layui-form-item" style="padding-top: 10px;">
				<label class="layui-form-label">住院人姓名</label>
				<div class="layui-input-inline">
					<input type="text" name="name" class="layui-input"/>
				</div>
			</div>

			<div class="layui-form-item" >
				<label class="layui-form-label">工资号</label>
				<div class="layui-input-inline">
					<input type="text" name="salaryNumber" lay-verify="identity" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">性别</label>
				<div >
					<input type="radio" name="sex" value="男" title="男" checked>
					<input type="radio" name="sex" value="女" title="女">
				</div>
			</div>

			<div class="layui-form-item"  >
				<label class="layui-form-label">住院时间</label>
				<div class="layui-input-inline" style="margin-top: 5px">
					<input type="text" name="illtime" class="layui-input" id="laydate_start_work_date">
				</div>
			</div>


			<div class="layui-form-item">
				<label class="layui-form-label">住院原因</label>
				<div class="layui-input-inline">
					<textarea lay-ignore class="select" type="text" name="reason"
							  style="padding-top: 13px;resize:none;border: 1px solid lightgray;width:400px;"></textarea>
				</div>
			</div>

			<div class="layui-form-item" >
				<label class="layui-form-label">探望次数</label>
				<div class="layui-input-inline">
					<input type="text" name="retireDate" class="layui-input">
				</div>
			</div>

		</div>


<br>
		<br>
		<div class="layui-form-item" id="btngup_search" style="margin-bottom: 30px;" align="center">
			<div class="layui-input-block">
				<button class="layui-btn" lay-submit lay-filter="formSubmitSearch">查询</button>
				<button type="reset" class="layui-btn layui-btn-primary">清空</button>
			</div>
		</div>

	</form>
<br>
	<br>
	<br>
	<div style="width: 100%;margin: 0 auto;margin-bottom: 20px;background: rgb(0,150,136);padding-top: 6px;padding-bottom: 7px;padding-left: 5px;"><span
					style="color: white;font-size: 14px;letter-spacing: 3px;font-weight: bold;"><span style="font-size: 20px">3</span>&nbsp;查看结果</span></div>

	<div style="width:94%;margin:0 auto">
		<table id="info_table" lay-filter="info_table"></table>
	</div>
</div>
<script type="text/html" id="barDemo">
	<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
	<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
	<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
  layui.use(['table', 'form', 'layer', 'laydate'], function () {
    var table = layui.table;
    var form = layui.form;
    var laydate = layui.laydate;

    form.render();
    //监听提交
    form.on('submit(formSubmitSearch)', function (data) {
      console.log(JSON.stringify(data.field));
      return false;
    });
    laydate.render({
      elem: '#laydate_retire_date',
      type: 'date',
      range: '~'
    })
    table.render({
      elem: '#info_table',
      height: 315,
      url: '/baseInfo/findByPage' //数据接口
      ,
      page: true //开启分页
      ,
      cols: [
        [ //表头
          {
            type: 'checkbox',
            fixed: 'left'
          }, {
          field: 'name',
          title: '姓名',
          width: 80,
          sort: true,
          fixed: 'left'
        }, {
          field: 'idCard',
          title: '身份证号',
          width: 300
        }, {
          field: 'sex',
          title: '性别',
          width: 80,
          sort: true
        }, {
          field: 'nativePlace',
          title: '籍贯',
          width: 300
        }, {
          fixed: 'right',
          width: 178,
          align: 'center',
          toolbar: '#barDemo'
        }
        ]
      ],
      done: function (res, curr, count) {
        //如果是异步请求数据方式，res即为你接口返回的信息。
        //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
        console.log(res);

        //得到当前页码
        console.log(curr);

        //得到数据总量
        console.log(count);
      }
    });
    //监听表格复选框选择
    table.on('checkbox(info_table)', function (obj) {
      console.log(obj)
    });
    //监听工具条
    table.on('tool(info_table)', function (obj) {
      console.log(obj);
      var data = obj.data;
      if (obj.event === 'detail') {
        layer.msg('ID：' + data.id + ' 的查看操作');
      } else if (obj.event === 'del') {
        layer.confirm('真的删除行么', function (index) {
          obj.del();
          layer.close(index);
        });
      } else if (obj.event === 'edit') {
        layer.alert('编辑行：<br>' + JSON.stringify(data))
        // obj.update({
        //     username: '123'
        //     ,title: 'xxx'
        // });
      }
    });
  })
</script>
<script>
  layui.use(['table', 'form', 'formSelects'], function () {
    var formSelects = layui.formSelects;
    var form = layui.form;
    var $ = layui.$;
    $(function () {
      $(".show-labelitem").on("click", function () {
        $(this).hide();
        $(".hide-labelitem").show();
        $("#labelItem").show();
      });
      $(".hide-labelitem").on("click", function () {
        $(this).hide();
        $(".show-labelitem").show();
        $("#labelItem").hide();
      });
      $(".label-item").on("click", "li", function () {
        var id = $(this).attr("data");
        var text = $(this).children("span").html();
        var labelHTML = "<li data='" + id + "''>x " + text + "</li>";
        if ($(this).hasClass("selected")) {
          return false;
        }
        // else if ($(".label-selected").children("li").length >= 8) {
        //   layer.msg("最多可以选择8个哦");
        //   return false;
        // }
        $(".label-selected").append(labelHTML);
        val = '';
        for (var i = 0; i < $(".label-selected").children("li").length; i++) {
          val += $(".label-selected").children("li").eq(i).attr("data") + ',';
        }
        $("input[name='label']").val(val);
        $(this).addClass("selected");

        changeLabel();


      });
      var val = "";
      $(".label-selected").on("click", "li", function () {
        var id = $(this).attr("data");
        val = '';
        $(this).remove();
        for (var i = 0; i < $(".label-selected").children("li").length; i++) {
          val += $(".label-selected").children("li").eq(i).attr("data") + ',';
        }
        $("input[name='label']").val(val);
        $(".label-item").find("li[data='" + id + "']").removeClass("selected");


        changeLabel()
      });


      // //点击更换标签
      // var limit = 0;
      // $(".replacelable").on("click", function () {
      //   layer.load(1);
      //   limit += 32;
      //   $.ajax({
      //     url: window.location.href,
      //     type: "post",
      //     datatype: "json",
      //     data: {
      //       labellimit: limit
      //     },
      //     success: function (data) {
      //       layer.closeAll('loading');
      //       $(".label-item").find("li").remove();//删除原先所有，本来想让数据表随机搜索的，想着有点mmp，就没搞，用的是limit
      //       var html = '';
      //       for (var i in data) {
      //         html += "<li data=\"" + data[i].term_id + "\">x<span>" + data[i].name + "</span></li>";//拼接标签
      //       }
      //       $(".label-item").append(html);//追加至文档
      //     },
      //     error: function () {
      //       layer.closeAll('loading');
      //       layer.msg("错误~~~");
      //     }
      //   })
      // })
      //获取标签
      function changeLabel() {
        if ($("input[name='label']").val() == "") {
          $('#form_search').css('display', 'none')
          return false;
        } else {
          // layer.msg("标签内容为：" + $("input[name='label']").val());
          var labelList = $("input[name='label']").val().split(",");
          $('#form_search').css('display', 'block')
          $('.layui-form-item').css('display', 'none')
          $('#btngup_search').css('display', 'block')
          for (var i = 0; i < labelList.length - 1; i++) {
            var label = labelList[i]
            console.log(label)
            $('input[name=' + label + ']').parents('.layui-form-item').css('display', 'block')
          }
          form.render();
          formSelects.render();
        }
      }
    })
  })
</script>
<style>
	.wrap {
		width: 100%;
		max-width: 1200px;
		margin: 0 auto;
	}

	.label-selected {
		width: 100%;
		min-height: 38px;
		margin: 10px 0;
		border: 1px solid #ccc;
		background-color: #fff;
		position: relative;
	}

	.cell {
		display: block;
		width: 90px;
		height: 28px;
		line-height: 28px;
		border: 3px;
		background: #009688;
		color: #fff;
		text-align: center;
	}

	.label-selected li {
		display: inline-block;
		height: 27px;
		line-height: 27px;
		font-size: .8rem;
		padding: 0 1rem;
		border: 1px solid #e6e6e6;
		border-radius: 2px;
		cursor: pointer;
		margin: 4px 2px;
		color: #666;
	}

	#labelItem {
		margin-bottom: 10px;
		/*display: none;*/
	}

	.label-item {
		border: 1px solid #e6e6e6;
		padding: 10px;
		border-radius: 0 2px 2px 0;
		position: relative;
		overflow: hidden;
		background: #fff;
	}

	.label-item li {
		display: inline-block;
		height: 27px;
		line-height: 27px;
		font-size: .8rem;
		padding: 0 1rem;
		border: 1px solid #e6e6e6;
		border-radius: 2px;
		cursor: pointer;
		margin-bottom: 5px;
		margin-left: 2px;
		color: #666;
	}

	.label-item .selected {
		color: #ccc;
	}
</style>